function phnew=relaxPRESSUREprodRB3Dper2(ph,fh,numrel,pcoef)
[Em,En,Ep]=size(ph);
Emm=Em-1;
Enm=En-1;
Emmm=Em-2;
Enmm=En-2;
Emmmm=Em-3;
Enmmm=En-3;
Epm=Ep-1;
Epmm=Ep-2;
Epmmm=Ep-3;
% w=1.575;

w=1;
phnew=ph;
% Edens=[Edens,Edens(:,2)];



    rhsfixed=-fh(2:Emm,2:En,2:Ep)./pcoef.coef;
    
    rhsfixedboundB=-fh(1,2:En,2:Ep)./pcoef.coefboundB;
    rhsfixedboundT=-fh(Em,2:En,2:Ep)./pcoef.coefboundT;
   
    
    
%     rhsfixedsum=sum(sum(sum(rhsfixed)))+sum(sum(sum(rhsfixedboundB)))+sum(sum(sum(rhsfixedboundT)))...
%         +sum(sum(sum(rhsfixedboundR)))+sum(sum(sum(rhsfixedboundL)))+sum(sum(sum(rhsfixedboundBR)))...
%         +sum(sum(sum(rhsfixedboundBL)))+sum(sum(sum(rhsfixedboundTR)))+sum(sum(sum(rhsfixedboundTL)));
%     rhsfixedsize=Em*En*Ep;
%     rhsfixed=rhsfixed-rhsfixedsum/rhsfixedsize;
%     rhsfixedboundB=rhsfixedboundB-rhsfixedsum/rhsfixedsize;
%     rhsfixedboundT=rhsfixedboundT-rhsfixedsum/rhsfixedsize;
%     rhsfixedboundR=rhsfixedboundR-rhsfixedsum/rhsfixedsize;
%     rhsfixedboundL=rhsfixedboundL-rhsfixedsum/rhsfixedsize;
%     rhsfixedboundBR=rhsfixedboundBR-rhsfixedsum/rhsfixedsize;
%     rhsfixedboundBL=rhsfixedboundBL-rhsfixedsum/rhsfixedsize;
%     rhsfixedboundTR=rhsfixedboundTR-rhsfixedsum/rhsfixedsize;
%     rhsfixedboundTL=rhsfixedboundTL-rhsfixedsum/rhsfixedsize;

   

    
    for c1=1:numrel
%     phnew(2:Emm,2:Enm,2:Epm)=rhsfixed+pcoef.coefpp1.*phnew(2:Emm,3:En,2:Epm)+...
%         pcoef.coefpm1.*phnew(2:Emm,1:Enmm,2:Epm)+pcoef.coefpp2.*phnew(3:Em,2:Enm,2:Epm)+...
%         pcoef.coefpm2.*phnew(1:Emmm,2:Enm,2:Epm)+pcoef.coefpp3.*phnew(2:Emm,2:Enm,3:Ep)+...
%         pcoef.coefpm3.*phnew(2:Emm,2:Enm,1:Epmm);
%     
    %red even pgs
   
    phnew(2:2:Emm,2:2:Enm,2:2:Epm)=rhsfixed(1:2:Emmm,1:2:Enmm,1:2:Epmm)+pcoef.coefpp1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*phnew(2:2:Emm,3:2:En,2:2:Epm)+...
        pcoef.coefpm1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*phnew(2:2:Emm,1:2:Enmm,2:2:Epm)+pcoef.coefpp2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*phnew(3:2:Em,2:2:Enm,2:2:Epm)+...
        pcoef.coefpm2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*phnew(1:2:Emmm,2:2:Enm,2:2:Epm)+pcoef.coefpp3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*phnew(2:2:Emm,2:2:Enm,3:2:Ep)+...
        pcoef.coefpm3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*phnew(2:2:Emm,2:2:Enm,1:2:Epmm);
    
        phnew=phnew-mean(mean(mean(phnew)));

    
    phnew(3:2:Emmm,3:2:Enmm,2:2:Epm)=rhsfixed(2:2:Emmmm,2:2:Enmmm,1:2:Epmm)+pcoef.coefpp1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*phnew(3:2:Emmm,4:2:Enm,2:2:Epm)+...
        pcoef.coefpm1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*phnew(3:2:Emmm,2:2:Enmmm,2:2:Epm)+pcoef.coefpp2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*phnew(4:2:Emm,3:2:Enmm,2:2:Epm)+...
        pcoef.coefpm2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*phnew(2:2:Emmmm,3:2:Enmm,2:2:Epm)+pcoef.coefpp3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*phnew(3:2:Emmm,3:2:Enmm,3:2:Ep)+...
        pcoef.coefpm3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*phnew(3:2:Emmm,3:2:Enmm,1:2:Epmm);
    
        phnew=phnew-mean(mean(mean(phnew)));

    phnew(1,3:2:Enmm,2:2:Epm)=rhsfixedboundB(1,2:2:Enmmm,1:2:Epmm)+pcoef.coefpp1boundB(1,2:2:Enmmm,1:2:Epmm).*phnew(1,4:2:Enm,2:2:Epm)+...
        pcoef.coefpm1boundB(1,2:2:Enmmm,1:2:Epmm).*phnew(1,2:2:Enmmm,2:2:Epm)+pcoef.coefpp2boundB(1,2:2:Enmmm,1:2:Epmm).*phnew(2,3:2:Enmm,2:2:Epm)+...
        pcoef.coefpp3boundB(1,2:2:Enmmm,1:2:Epmm).*phnew(1,3:2:Enmm,3:2:Ep)+...
        pcoef.coefpm3boundB(1,2:2:Enmmm,1:2:Epmm).*phnew(1,3:2:Enmm,1:2:Epmm);
    
   phnew(Em,3:2:Enmm,2:2:Epm)=rhsfixedboundT(1,2:2:Enmmm,1:2:Epmm)+pcoef.coefpp1boundT(1,2:2:Enmmm,1:2:Epmm).*phnew(Em,4:2:Enm,2:2:Epm)+...
        pcoef.coefpm1boundT(1,2:2:Enmmm,1:2:Epmm).*phnew(Em,2:2:Enmmm,2:2:Epm)+pcoef.coefpm2boundT(1,2:2:Enmmm,1:2:Epmm).*phnew(Emm,3:2:Enmm,2:2:Epm)+...
        pcoef.coefpp3boundT(1,2:2:Enmmm,1:2:Epmm).*phnew(Em,3:2:Enmm,3:2:Ep)+...
        pcoef.coefpm3boundT(1,2:2:Enmmm,1:2:Epmm).*phnew(Em,3:2:Enmm,1:2:Epmm);
    
   phnew(3:2:Emmm,En,2:2:Epm)=rhsfixed(2:2:Emmmm,Enm,1:2:Epmm)+pcoef.coefpp1(2:2:Emmmm,Enm,1:2:Epmm).*phnew(3:2:Emmm,2,2:2:Epm)+...
        pcoef.coefpm1(2:2:Emmmm,Enm,1:2:Epmm).*phnew(3:2:Emmm,Enm,2:2:Epm)+pcoef.coefpp2(2:2:Emmmm,Enm,1:2:Epmm).*phnew(4:2:Emm,En,2:2:Epm)+...
        pcoef.coefpm2(2:2:Emmmm,Enm,1:2:Epmm).*phnew(2:2:Emmmm,En,2:2:Epm)+pcoef.coefpp3(2:2:Emmmm,Enm,1:2:Epmm).*phnew(3:2:Emmm,En,3:2:Ep)+...
        pcoef.coefpm3(2:2:Emmmm,Enm,1:2:Epmm).*phnew(3:2:Emmm,En,1:2:Epmm);
    phnew(:,1,:)=phnew(:,En,:);
    
    
 phnew(1,En,2:2:Epm)=rhsfixedboundB(1,Enm,1:2:Epmm)+pcoef.coefpp1boundB(1,Enm,1:2:Epmm).*phnew(1,2,2:2:Epm)+...
        pcoef.coefpm1boundB(1,Enm,1:2:Epmm).*phnew(1,Enm,2:2:Epm)+pcoef.coefpp2boundB(1,Enm,1:2:Epmm).*phnew(2,En,2:2:Epm)+...
        pcoef.coefpp3boundB(1,Enm,1:2:Epmm).*phnew(1,En,3:2:Ep)+...
        pcoef.coefpm3boundB(1,Enm,1:2:Epmm).*phnew(1,En,1:2:Epmm);
    
 phnew(Em,En,2:2:Epm)=rhsfixedboundT(1,Enm,1:2:Epmm)+pcoef.coefpp1boundT(1,Enm,1:2:Epmm).*phnew(Em,2,2:2:Epm)+...
        pcoef.coefpm1boundT(1,Enm,1:2:Epmm).*phnew(Em,Enm,2:2:Epm)+pcoef.coefpm2boundT(1,Enm,1:2:Epmm).*phnew(Emm,En,2:2:Epm)+...
        pcoef.coefpp3boundT(1,Enm,1:2:Epmm).*phnew(Em,En,3:2:Ep)+...
        pcoef.coefpm3boundT(1,Enm,1:2:Epmm).*phnew(Em,En,1:2:Epmm);
    phnew(:,1,:)=phnew(:,En,:);
    
    phnew(:,:,1)=phnew(:,:,Ep);

    phnew=phnew-mean(mean(mean(phnew)));

    
    
    

    
    %red odd pgs
    phnew(2:2:Emm,3:2:Enmm,3:2:Epmm)=rhsfixed(1:2:Emmm,2:2:Enmmm,2:2:Epmmm)+pcoef.coefpp1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*phnew(2:2:Emm,4:2:Enm,3:2:Epmm)+...
        pcoef.coefpm1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*phnew(2:2:Emm,2:2:Enmmm,3:2:Epmm)+pcoef.coefpp2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*phnew(3:2:Em,3:2:Enmm,3:2:Epmm)+...
        pcoef.coefpm2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*phnew(1:2:Emmm,3:2:Enmm,3:2:Epmm)+pcoef.coefpp3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*phnew(2:2:Emm,3:2:Enmm,4:2:Epm)+...
        pcoef.coefpm3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*phnew(2:2:Emm,3:2:Enmm,2:2:Epmmm);
    
        phnew=phnew-mean(mean(mean(phnew)));

    
    phnew(2:2:Emm,3:2:Enmm,Ep)=rhsfixed(1:2:Emmm,2:2:Enmmm,Epm)+pcoef.coefpp1(1:2:Emmm,2:2:Enmmm,Epm).*phnew(2:2:Emm,4:2:Enm,Ep)+...
        pcoef.coefpm1(1:2:Emmm,2:2:Enmmm,Epm).*phnew(2:2:Emm,2:2:Enmmm,Ep)+pcoef.coefpp2(1:2:Emmm,2:2:Enmmm,Epm).*phnew(3:2:Em,3:2:Enmm,Ep)+...
        pcoef.coefpm2(1:2:Emmm,2:2:Enmmm,Epm).*phnew(1:2:Emmm,3:2:Enmm,Ep)+pcoef.coefpp3(1:2:Emmm,2:2:Enmmm,Epm).*phnew(2:2:Emm,3:2:Enmm,2)+...
        pcoef.coefpm3(1:2:Emmm,2:2:Enmmm,Epm).*phnew(2:2:Emm,3:2:Enmm,Epm);
    phnew(:,:,1)=phnew(:,:,Ep);
    
        phnew=phnew-mean(mean(mean(phnew)));

    
    phnew(2:2:Emm,En,3:2:Epmm)=rhsfixed(1:2:Emmm,Enm,2:2:Epmmm)+pcoef.coefpp1(1:2:Emmm,Enm,2:2:Epmmm).*phnew(2:2:Emm,2,3:2:Epmm)+...
        pcoef.coefpm1(1:2:Emmm,Enm,2:2:Epmmm).*phnew(2:2:Emm,Enm,3:2:Epmm)+pcoef.coefpp2(1:2:Emmm,Enm,2:2:Epmmm).*phnew(3:2:Em,En,3:2:Epmm)+...
        pcoef.coefpm2(1:2:Emmm,Enm,2:2:Epmmm).*phnew(1:2:Emmm,En,3:2:Epmm)+pcoef.coefpp3(1:2:Emmm,Enm,2:2:Epmmm).*phnew(2:2:Emm,En,4:2:Epm)+...
        pcoef.coefpm3(1:2:Emmm,Enm,2:2:Epmmm).*phnew(2:2:Emm,En,2:2:Epmmm);
    phnew(:,1,:)=phnew(:,En,:);
    
    
  phnew(2:2:Emm,En,Ep)=rhsfixed(1:2:Emmm,Enm,Epm)+pcoef.coefpp1(1:2:Emmm,Enm,Epm).*phnew(2:2:Emm,2,Ep)+...
        pcoef.coefpm1(1:2:Emmm,Enm,Epm).*phnew(2:2:Emm,Enm,Ep)+pcoef.coefpp2(1:2:Emmm,Enm,Epm).*phnew(3:2:Em,En,Ep)+...
        pcoef.coefpm2(1:2:Emmm,Enm,Epm).*phnew(1:2:Emmm,En,Ep)+pcoef.coefpp3(1:2:Emmm,Enm,Epm).*phnew(2:2:Emm,En,2)+...
        pcoef.coefpm3(1:2:Emmm,Enm,Epm).*phnew(2:2:Emm,En,Epm);
    phnew(:,1,:)=phnew(:,En,:);
    
    phnew(:,:,1)=phnew(:,:,Ep);

    
        phnew=phnew-mean(mean(mean(phnew)));

    
    phnew(3:2:Emmm,2:2:Enm,3:2:Epmm)=rhsfixed(2:2:Emmmm,1:2:Enmm,2:2:Epmmm)+pcoef.coefpp1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*phnew(3:2:Emmm,3:2:En,3:2:Epmm)+...
        pcoef.coefpm1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*phnew(3:2:Emmm,1:2:Enmm,3:2:Epmm)+pcoef.coefpp2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*phnew(4:2:Emm,2:2:Enm,3:2:Epmm)+...
        pcoef.coefpm2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*phnew(2:2:Emmmm,2:2:Enm,3:2:Epmm)+pcoef.coefpp3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*phnew(3:2:Emmm,2:2:Enm,4:2:Epm)+...
        pcoef.coefpm3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*phnew(3:2:Emmm,2:2:Enm,2:2:Epmmm);
    
        phnew=phnew-mean(mean(mean(phnew)));

    phnew(3:2:Emmm,2:2:Enm,Ep)=rhsfixed(2:2:Emmmm,1:2:Enmm,Epm)+pcoef.coefpp1(2:2:Emmmm,1:2:Enmm,Epm).*phnew(3:2:Emmm,3:2:En,Ep)+...
        pcoef.coefpm1(2:2:Emmmm,1:2:Enmm,Epm).*phnew(3:2:Emmm,1:2:Enmm,Ep)+pcoef.coefpp2(2:2:Emmmm,1:2:Enmm,Epm).*phnew(4:2:Emm,2:2:Enm,Ep)+...
        pcoef.coefpm2(2:2:Emmmm,1:2:Enmm,Epm).*phnew(2:2:Emmmm,2:2:Enm,Ep)+pcoef.coefpp3(2:2:Emmmm,1:2:Enmm,Epm).*phnew(3:2:Emmm,2:2:Enm,2)+...
        pcoef.coefpm3(2:2:Emmmm,1:2:Enmm,Epm).*phnew(3:2:Emmm,2:2:Enm,Epm);
    phnew(:,:,1)=phnew(:,:,Ep);
    
        phnew=phnew-mean(mean(mean(phnew)));

    
    phnew(1,2:2:Enm,3:2:Epmm)=rhsfixedboundB(1,1:2:Enmm,2:2:Epmmm)+pcoef.coefpp1boundB(1,1:2:Enmm,2:2:Epmmm).*phnew(1,3:2:En,3:2:Epmm)+...
        pcoef.coefpm1boundB(1,1:2:Enmm,2:2:Epmmm).*phnew(1,1:2:Enmm,3:2:Epmm)+pcoef.coefpp2boundB(1,1:2:Enmm,2:2:Epmmm).*phnew(2,2:2:Enm,3:2:Epmm)+...
        pcoef.coefpp3boundB(1,1:2:Enmm,2:2:Epmmm).*phnew(1,2:2:Enm,4:2:Epm)+...
        pcoef.coefpm3boundB(1,1:2:Enmm,2:2:Epmmm).*phnew(1,2:2:Enm,2:2:Epmmm);
    
    phnew(1,2:2:Enm,Ep)=rhsfixedboundB(1,1:2:Enmm,Epm)+pcoef.coefpp1boundB(1,1:2:Enmm,Epm).*phnew(1,3:2:En,Ep)+...
        pcoef.coefpm1boundB(1,1:2:Enmm,Epm).*phnew(1,1:2:Enmm,Ep)+pcoef.coefpp2boundB(1,1:2:Enmm,Epm).*phnew(2,2:2:Enm,Ep)+...
        pcoef.coefpp3boundB(1,1:2:Enmm,Epm).*phnew(1,2:2:Enm,2)+...
        pcoef.coefpm3boundB(1,1:2:Enmm,Epm).*phnew(1,2:2:Enm,Epm);
    phnew(:,:,1)=phnew(:,:,Ep);


    
    phnew(Em,2:2:Enm,3:2:Epmm)=rhsfixedboundT(1,1:2:Enmm,2:2:Epmmm)+pcoef.coefpp1boundT(1,1:2:Enmm,2:2:Epmmm).*phnew(Em,3:2:En,3:2:Epmm)+...
        pcoef.coefpm1boundT(1,1:2:Enmm,2:2:Epmmm).*phnew(Em,1:2:Enmm,3:2:Epmm)+pcoef.coefpm2boundT(1,1:2:Enmm,2:2:Epmmm).*phnew(Emm,2:2:Enm,3:2:Epmm)+...
        pcoef.coefpp3boundT(1,1:2:Enmm,2:2:Epmmm).*phnew(Em,2:2:Enm,4:2:Epm)+...
        pcoef.coefpm3boundT(1,1:2:Enmm,2:2:Epmmm).*phnew(Em,2:2:Enm,2:2:Epmmm);
    
    phnew(Em,2:2:Enm,Ep)=rhsfixedboundT(1,1:2:Enmm,Epm)+pcoef.coefpp1boundT(1,1:2:Enmm,Epm).*phnew(Em,3:2:En,Ep)+...
        pcoef.coefpm1boundT(1,1:2:Enmm,Epm).*phnew(Em,1:2:Enmm,Ep)+pcoef.coefpm2boundT(1,1:2:Enmm,Epm).*phnew(Emm,2:2:Enm,Ep)+...
        pcoef.coefpp3boundT(1,1:2:Enmm,Epm).*phnew(Em,2:2:Enm,2)+...
        pcoef.coefpm3boundT(1,1:2:Enmm,Epm).*phnew(Em,2:2:Enm,Epm);

    phnew(:,:,1)=phnew(:,:,Ep);

        phnew=phnew-mean(mean(mean(phnew)));

    
    
    
    %black even pgs
    phnew(2:2:Emm,3:2:Enmm,2:2:Epm)=rhsfixed(1:2:Emmm,2:2:Enmmm,1:2:Epmm)+pcoef.coefpp1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*phnew(2:2:Emm,4:2:Enm,2:2:Epm)+...
        pcoef.coefpm1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*phnew(2:2:Emm,2:2:Enmmm,2:2:Epm)+pcoef.coefpp2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*phnew(3:2:Em,3:2:Enmm,2:2:Epm)+...
        pcoef.coefpm2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*phnew(1:2:Emmm,3:2:Enmm,2:2:Epm)+pcoef.coefpp3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*phnew(2:2:Emm,3:2:Enmm,3:2:Ep)+...
        pcoef.coefpm3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*phnew(2:2:Emm,3:2:Enmm,1:2:Epmm);
    
        phnew=phnew-mean(mean(mean(phnew)));

    
    phnew(2:2:Emm,En,2:2:Epm)=rhsfixed(1:2:Emmm,Enm,1:2:Epmm)+pcoef.coefpp1(1:2:Emmm,Enm,1:2:Epmm).*phnew(2:2:Emm,2,2:2:Epm)+...
        pcoef.coefpm1(1:2:Emmm,Enm,1:2:Epmm).*phnew(2:2:Emm,Enm,2:2:Epm)+pcoef.coefpp2(1:2:Emmm,Enm,1:2:Epmm).*phnew(3:2:Em,En,2:2:Epm)+...
        pcoef.coefpm2(1:2:Emmm,Enm,1:2:Epmm).*phnew(1:2:Emmm,En,2:2:Epm)+pcoef.coefpp3(1:2:Emmm,Enm,1:2:Epmm).*phnew(2:2:Emm,En,3:2:Ep)+...
        pcoef.coefpm3(1:2:Emmm,Enm,1:2:Epmm).*phnew(2:2:Emm,En,1:2:Epmm);
    phnew(2:2:Emm,1,2:2:Epm)=phnew(2:2:Emm,En,2:2:Epm);
    
        phnew=phnew-mean(mean(mean(phnew)));

    
    
    phnew(3:2:Emmm,2:2:Enm,2:2:Epm)=rhsfixed(2:2:Emmmm,1:2:Enmm,1:2:Epmm)+pcoef.coefpp1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*phnew(3:2:Emmm,3:2:En,2:2:Epm)+...
        pcoef.coefpm1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*phnew(3:2:Emmm,1:2:Enmm,2:2:Epm)+pcoef.coefpp2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*phnew(4:2:Emm,2:2:Enm,2:2:Epm)+...
        pcoef.coefpm2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*phnew(2:2:Emmmm,2:2:Enm,2:2:Epm)+pcoef.coefpp3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*phnew(3:2:Emmm,2:2:Enm,3:2:Ep)+...
        pcoef.coefpm3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*phnew(3:2:Emmm,2:2:Enm,1:2:Epmm);
    
        phnew=phnew-mean(mean(mean(phnew)));

    
    phnew(1,2:2:Enm,2:2:Epm)=rhsfixedboundB(1,1:2:Enmm,1:2:Epmm)+pcoef.coefpp1boundB(1,1:2:Enmm,1:2:Epmm).*phnew(1,3:2:En,2:2:Epm)+...
        pcoef.coefpm1boundB(1,1:2:Enmm,1:2:Epmm).*phnew(1,1:2:Enmm,2:2:Epm)+pcoef.coefpp2boundB(1,1:2:Enmm,1:2:Epmm).*phnew(2,2:2:Enm,2:2:Epm)+...
        pcoef.coefpp3boundB(1,1:2:Enmm,1:2:Epmm).*phnew(1,2:2:Enm,3:2:Ep)+...
        pcoef.coefpm3boundB(1,1:2:Enmm,1:2:Epmm).*phnew(1,2:2:Enm,1:2:Epmm);
    
    phnew(Em,2:2:Enm,2:2:Epm)=rhsfixedboundT(1,1:2:Enmm,1:2:Epmm)+pcoef.coefpp1boundT(1,1:2:Enmm,1:2:Epmm).*phnew(Em,3:2:En,2:2:Epm)+...
        pcoef.coefpm1boundT(1,1:2:Enmm,1:2:Epmm).*phnew(Em,1:2:Enmm,2:2:Epm)+pcoef.coefpm2boundT(1,1:2:Enmm,1:2:Epmm).*phnew(Emm,2:2:Enm,2:2:Epm)+...
        pcoef.coefpp3boundT(1,1:2:Enmm,1:2:Epmm).*phnew(Em,2:2:Enm,3:2:Ep)+...
        pcoef.coefpm3boundT(1,1:2:Enmm,1:2:Epmm).*phnew(Em,2:2:Enm,1:2:Epmm);
    
    phnew(:,:,1)=phnew(:,:,Ep);

        phnew=phnew-mean(mean(mean(phnew)));

    
    %black odd pgs
    phnew(3:2:Emmm,3:2:Enmm,3:2:Epmm)=rhsfixed(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm)+pcoef.coefpp1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*phnew(3:2:Emmm,4:2:Enm,3:2:Epmm)+...
        pcoef.coefpm1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*phnew(3:2:Emmm,2:2:Enmmm,3:2:Epmm)+pcoef.coefpp2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*phnew(4:2:Emm,3:2:Enmm,3:2:Epmm)+...
        pcoef.coefpm2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*phnew(2:2:Emmmm,3:2:Enmm,3:2:Epmm)+pcoef.coefpp3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*phnew(3:2:Emmm,3:2:Enmm,4:2:Epm)+...
        pcoef.coefpm3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*phnew(3:2:Emmm,3:2:Enmm,2:2:Epmmm);
    
        phnew=phnew-mean(mean(mean(phnew)));

    
     phnew(1,3:2:Enmm,3:2:Epmm)=rhsfixedboundB(1,2:2:Enmmm,2:2:Epmmm)+pcoef.coefpp1boundB(1,2:2:Enmmm,2:2:Epmmm).*phnew(1,4:2:Enm,3:2:Epmm)+...
        pcoef.coefpm1boundB(1,2:2:Enmmm,2:2:Epmmm).*phnew(1,2:2:Enmmm,3:2:Epmm)+pcoef.coefpp2boundB(1,2:2:Enmmm,2:2:Epmmm).*phnew(2,3:2:Enmm,3:2:Epmm)+...
        pcoef.coefpp3boundB(1,2:2:Enmmm,2:2:Epmmm).*phnew(1,3:2:Enmm,4:2:Epm)+...
        pcoef.coefpm3boundB(1,2:2:Enmmm,2:2:Epmmm).*phnew(1,3:2:Enmm,2:2:Epmmm);
    
    phnew(1,3:2:Enmm,Ep)=rhsfixedboundB(1,2:2:Enmmm,Epm)+pcoef.coefpp1boundB(1,2:2:Enmmm,Epm).*phnew(1,4:2:Enm,Ep)+...
        pcoef.coefpm1boundB(1,2:2:Enmmm,Epm).*phnew(1,2:2:Enmmm,Ep)+pcoef.coefpp2boundB(1,2:2:Enmmm,Epm).*phnew(2,3:2:Enmm,Ep)+...
        pcoef.coefpp3boundB(1,2:2:Enmmm,Epm).*phnew(1,3:2:Enmm,2)+...
        pcoef.coefpm3boundB(1,2:2:Enmmm,Epm).*phnew(1,3:2:Enmm,Epm);
    phnew(:,:,1)=phnew(:,:,Ep);

    
    phnew(Em,3:2:Enmm,3:2:Epmm)=rhsfixedboundT(1,2:2:Enmmm,2:2:Epmmm)+pcoef.coefpp1boundT(1,2:2:Enmmm,2:2:Epmmm).*phnew(Em,4:2:Enm,3:2:Epmm)+...
        pcoef.coefpm1boundT(1,2:2:Enmmm,2:2:Epmmm).*phnew(Em,2:2:Enmmm,3:2:Epmm)+pcoef.coefpm2boundT(1,2:2:Enmmm,2:2:Epmmm).*phnew(Emm,3:2:Enmm,3:2:Epmm)+...
        pcoef.coefpp3boundT(1,2:2:Enmmm,2:2:Epmmm).*phnew(Em,3:2:Enmm,4:2:Epm)+...
        pcoef.coefpm3boundT(1,2:2:Enmmm,2:2:Epmmm).*phnew(Em,3:2:Enmm,2:2:Epmmm);

    phnew(Em,3:2:Enmm,Ep)=rhsfixedboundT(1,2:2:Enmmm,Epm)+pcoef.coefpp1boundT(1,2:2:Enmmm,Epm).*phnew(Em,4:2:Enm,Ep)+...
        pcoef.coefpm1boundT(1,2:2:Enmmm,Epm).*phnew(Em,2:2:Enmmm,Ep)+pcoef.coefpm2boundT(1,2:2:Enmmm,Epm).*phnew(Emm,3:2:Enmm,Ep)+...
        pcoef.coefpp3boundT(1,2:2:Enmmm,Epm).*phnew(Em,3:2:Enmm,2)+...
        pcoef.coefpm3boundT(1,2:2:Enmmm,Epm).*phnew(Em,3:2:Enmm,Epm);
   phnew(:,:,1)=phnew(:,:,Ep);
 
       phnew=phnew-mean(mean(mean(phnew)));

   
     phnew(3:2:Emmm,En,3:2:Epmm)=rhsfixed(2:2:Emmmm,Enm,2:2:Epmmm)+pcoef.coefpp1(2:2:Emmmm,Enm,2:2:Epmmm).*phnew(3:2:Emmm,2,3:2:Epmm)+...
        pcoef.coefpm1(2:2:Emmmm,Enm,2:2:Epmmm).*phnew(3:2:Emmm,Enm,3:2:Epmm)+pcoef.coefpp2(2:2:Emmmm,Enm,2:2:Epmmm).*phnew(4:2:Emm,En,3:2:Epmm)+...
        pcoef.coefpm2(2:2:Emmmm,Enm,2:2:Epmmm).*phnew(2:2:Emmmm,En,3:2:Epmm)+pcoef.coefpp3(2:2:Emmmm,Enm,2:2:Epmmm).*phnew(3:2:Emmm,En,4:2:Epm)+...
        pcoef.coefpm3(2:2:Emmmm,Enm,2:2:Epmmm).*phnew(3:2:Emmm,En,2:2:Epmmm);
    phnew(:,1,:)=phnew(:,En,:);
    
   phnew(3:2:Emmm,En,Ep)=rhsfixed(2:2:Emmmm,Enm,Epm)+pcoef.coefpp1(2:2:Emmmm,Enm,Epm).*phnew(3:2:Emmm,2,Ep)+...
        pcoef.coefpm1(2:2:Emmmm,Enm,Epm).*phnew(3:2:Emmm,Enm,Ep)+pcoef.coefpp2(2:2:Emmmm,Enm,Epm).*phnew(4:2:Emm,En,Ep)+...
        pcoef.coefpm2(2:2:Emmmm,Enm,Epm).*phnew(2:2:Emmmm,En,Ep)+pcoef.coefpp3(2:2:Emmmm,Enm,Epm).*phnew(3:2:Emmm,En,2)+...
        pcoef.coefpm3(2:2:Emmmm,Enm,Epm).*phnew(3:2:Emmm,En,Epm);
    phnew(:,1,:)=phnew(:,En,:);

    phnew(:,:,1)=phnew(:,:,Ep);
    
        phnew=phnew-mean(mean(mean(phnew)));


    %creases 
    
   
    phnew(1,En,3:2:Epmm)=rhsfixedboundB(1,Enm,2:2:Epmmm)+pcoef.coefpp1boundB(1,Enm,2:2:Epmmm).*phnew(1,2,3:2:Epmm)+...
        pcoef.coefpm1boundB(1,Enm,2:2:Epmmm).*phnew(1,Enm,3:2:Epmm)+pcoef.coefpp2boundB(1,Enm,2:2:Epmmm).*phnew(2,En,3:2:Epmm)+...
        pcoef.coefpp3boundB(1,Enm,2:2:Epmmm).*phnew(1,En,4:2:Epm)+...
        pcoef.coefpm3boundB(1,Enm,2:2:Epmmm).*phnew(1,En,2:2:Epmmm);
    
    phnew(:,1,:)=phnew(:,En,:);
    
    phnew(1,En,Ep)=rhsfixedboundB(1,Enm,Epm)+pcoef.coefpp1boundB(1,Enm,Epm).*phnew(1,2,Ep)+...
        pcoef.coefpm1boundB(1,Enm,Epm).*phnew(1,Enm,Ep)+pcoef.coefpp2boundB(1,Enm,Epm).*phnew(2,En,Ep)+...
        pcoef.coefpp3boundB(1,Enm,Epm).*phnew(1,En,2)+...
        pcoef.coefpm3boundB(1,Enm,Epm).*phnew(1,En,Epm);
    phnew(1,1,Ep)=phnew(1,En,Ep);
    phnew(1,En,1)=phnew(1,En,Ep);
    phnew(1,1,1)=phnew(1,En,Ep);
    
    phnew(:,:,1)=phnew(:,:,Ep);

  
    
     phnew(Em,En,3:2:Epmm)=rhsfixedboundT(1,Enm,2:2:Epmmm)+pcoef.coefpp1boundT(1,Enm,2:2:Epmmm).*phnew(Em,2,3:2:Epmm)+...
        pcoef.coefpm1boundT(1,Enm,2:2:Epmmm).*phnew(Em,Enm,3:2:Epmm)+pcoef.coefpm2boundT(1,Enm,2:2:Epmmm).*phnew(Emm,En,3:2:Epmm)+...
        pcoef.coefpp3boundT(1,Enm,2:2:Epmmm).*phnew(Em,En,4:2:Epm)+...
        pcoef.coefpm3boundT(1,Enm,2:2:Epmmm).*phnew(Em,En,2:2:Epmmm);
    
    phnew(:,1,:)=phnew(:,En,:);
    
    phnew(Em,En,Ep)=rhsfixedboundT(1,Enm,Epm)+pcoef.coefpp1boundT(1,Enm,Epm).*phnew(Em,2,Ep)+...
        pcoef.coefpm1boundT(1,Enm,Epm).*phnew(Em,Enm,Ep)+pcoef.coefpm2boundT(1,Enm,Epm).*phnew(Emm,En,Ep)+...
        pcoef.coefpp3boundT(1,Enm,Epm).*phnew(Em,En,2)+...
        pcoef.coefpm3boundT(1,Enm,Epm).*phnew(Em,En,Epm);
    phnew(Em,1,Ep)=phnew(Em,En,Ep);
    phnew(Em,En,1)=phnew(Em,En,Ep);
    phnew(Em,1,1)=phnew(Em,En,Ep);
    
    phnew(:,:,1)=phnew(:,:,Ep);

    
    
     phnew(3:2:Emmm,3:2:Enmm,Ep)=rhsfixed(2:2:Emmmm,2:2:Enmmm,Epm)+pcoef.coefpp1(2:2:Emmmm,2:2:Enmmm,Epm).*phnew(3:2:Emmm,4:2:Enm,Ep)+...
        pcoef.coefpm1(2:2:Emmmm,2:2:Enmmm,Epm).*phnew(3:2:Emmm,2:2:Enmmm,Ep)+pcoef.coefpp2(2:2:Emmmm,2:2:Enmmm,Epm).*phnew(4:2:Emm,3:2:Enmm,Ep)+...
        pcoef.coefpm2(2:2:Emmmm,2:2:Enmmm,Epm).*phnew(2:2:Emmmm,3:2:Enmm,Ep)+pcoef.coefpp3(2:2:Emmmm,2:2:Enmmm,Epm).*phnew(3:2:Emmm,3:2:Enmm,2)+...
        pcoef.coefpm3(2:2:Emmmm,2:2:Enmmm,Epm).*phnew(3:2:Emmm,3:2:Enmm,Epm);
    
    phnew(:,:,1)=phnew(:,:,Ep);

    
        phnew=phnew-mean(mean(mean(phnew)));


    phnew(2:2:Emm,2:2:Enm,3:2:Epmm)=rhsfixed(1:2:Emmm,1:2:Enmm,2:2:Epmmm)+pcoef.coefpp1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*phnew(2:2:Emm,3:2:En,3:2:Epmm)+...
        pcoef.coefpm1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*phnew(2:2:Emm,1:2:Enmm,3:2:Epmm)+pcoef.coefpp2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*phnew(3:2:Em,2:2:Enm,3:2:Epmm)+...
        pcoef.coefpm2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*phnew(1:2:Emmm,2:2:Enm,3:2:Epmm)+pcoef.coefpp3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*phnew(2:2:Emm,2:2:Enm,4:2:Epm)+...
        pcoef.coefpm3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*phnew(2:2:Emm,2:2:Enm,2:2:Epmmm);
    
        phnew=phnew-mean(mean(mean(phnew)));

   
    phnew(2:2:Emm,2:2:Enm,Ep)=rhsfixed(1:2:Emmm,1:2:Enmm,Epm)+pcoef.coefpp1(1:2:Emmm,1:2:Enmm,Epm).*phnew(2:2:Emm,3:2:En,Ep)+...
        pcoef.coefpm1(1:2:Emmm,1:2:Enmm,Epm).*phnew(2:2:Emm,1:2:Enmm,Ep)+pcoef.coefpp2(1:2:Emmm,1:2:Enmm,Epm).*phnew(3:2:Em,2:2:Enm,Ep)+...
        pcoef.coefpm2(1:2:Emmm,1:2:Enmm,Epm).*phnew(1:2:Emmm,2:2:Enm,Ep)+pcoef.coefpp3(1:2:Emmm,1:2:Enmm,Epm).*phnew(2:2:Emm,2:2:Enm,2)+...
        pcoef.coefpm3(1:2:Emmm,1:2:Enmm,Epm).*phnew(2:2:Emm,2:2:Enm,Epm);
    
    phnew(:,:,1)=phnew(:,:,Ep);

    

    phnew(:,:,1)=phnew(:,:,Ep);
    phnew(:,1,:)=phnew(:,En,:);
    phnew=phnew-mean(mean(mean(phnew)));
    
    
    
%     phnew=(1-w)*ph+w*phnew;
%     ph=phnew;
%    
    end

